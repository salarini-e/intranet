{% extends 'template.html' %}
{% load custom %}
{% load custom_filters %}	
{% block visao %}active{% endblock %}
{% block main %}   

				<!-- Owl Carousel CSS -->
				<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
				<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
				<style>
					
					.owl-carousel .item {
					  background: #4a90e2;
					  color: white;
					  text-align: center;
					  font-size: 18px;
					  width: 100% !important;
					  height: auto;
					  border-radius: 10px;
					}
					.owl-carousel .owl-item{
						opacity: 20%;
					}
					.owl-carousel .center {
						opacity: 200% !important;
						
					}
					@media (min-width: 1400px) {
						.container-xxl, .container-xl, .container-lg, .container-md, .container-sm, .container {
							max-width: 1550px;
						}
					}
				  </style>
			
				<!-- Owl Carousel JS -->
				<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
				<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
				<script>
					$(document).ready(function(){
					  $(".owl-carousel").owlCarousel({
						center: true,
						items: 3,
						loop: true,
						margin: 10,
						autoplay: true,         // Ativa a reprodução automática
						autoplayTimeout: 5000,  // Define o tempo entre as transições (5 segundos)
						autoplayHoverPause: true, // Pausa o autoplay ao passar o mouse
						responsive: {
						  0: {
							items: 1
						  },
						  600: {
							items: 1
						  },
						  1000: {
							items: 1.5
						  }
						}
					  });
					});
				  </script>
			    <!-- <h1 class="app-page-title">Bem vindo, servidor!</h1>			     -->
			    <!-- <div class="app-card alert alert-dismissible shadow-sm mb-4 border-left-decoration" role="alert">
				    <div class="inner">
					    <div class="app-card-body p-3 p-lg-4">
						    <h3 class="mb-3">Bem-vindo, servidor!</h3>
						    <div class="row gx-5 gy-3">
						        <div class="col-12 col-lg-9">							        
							        <div>Nossa intranet é a ferramenta essencial para colaboração e eficiência no serviço público. Aqui, os servidores encontram recursos e informações para melhor desempenho de suas funções.</div>
							    </div>							    
						    </div>
						    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					    </div>					    
				    </div>
			    </div> -->
				
				<style>
					.text-justify{
						text-align: justify;
					}	
				</style>
				<h1 class="mb-3">Bem vindo, servidor!</h1>			
				<div class="row pb-4">
					<div class="col pb-4">
						<div class="w-100 owl-carousel owl-theme">
							{% for item in carrousel %}
							<div class="item" style="background-image: url('{{item.imagem.url}}'); background-size: cover;">
								<a href="{{item.link}}">
									<img src="{{item.imagem.url}}" style="opacity: 0;" alt="{{item.alt}}">
								</a>
							</div>
							{% endfor %}								
						</div>
					</div>
				</div>								
				<div class="mb-5">
				{% comment %}	
				<div id="mainNoticias" class="pt-2 pe-4 row g-4 app-card">
					
				    <div class="col-12 col-lg-6">
				        <div class="pe-5 ps-4 pb-3 h-100">
							<h3 class="mb-4">INTRANET</h3>
							<!-- <h3 class="mb-4">Últimas Notificações</h3>
							{% if notifications %}							
								{% for notification in notifications %}
								<a class="w-100" style="height: auto !important;" href="{{ notification.link }}">
									<div class="py-2" style="width: 100%; height: auto; text-align: center; background-color: #4ae2630e !important; color: #5e667a;">
										{% if "fa-" in notification.icone %}
										<i class="{{ notification.icone }} text-xl me-2"></i>
										{% else %}
										<img class="w-10 h-10 rounded-full me-2" src="{{ notification.icone }}" alt="Ícone">
										{% endif %}
										{{ notification.msg|safe }}
									</div>
								</a><br>
								{% endfor %}	
							{% endif %} -->
							<p class="text-justify mx-3">
								A Intranet é o nosso espaço exclusivo de comunicação interna, pensado para facilitar o acesso a informações, recursos e novidades sobre a organização. Aqui, você pode acompanhar as notícias mais recentes, conferir os documentos importantes e se conectar com outras áreas e equipes.
							</p>
							<p class="text-justify mx-3">
								Explore nossos conteúdos e fique por dentro de tudo o que acontece. Este é o lugar onde a colaboração se transforma em resultados e onde o trabalho em equipe é fortalecido a cada clique.
							</p>							
				        </div>
			        </div>					
					<div class="col">
						<div class="row">	
							<h3 class="mb-3">Notícias em Destaque</h3>
							{% for destaque in destaques %}
							<div class="col-lg-6 col-md-5 col-sm-12 mb-4 destaques">
								<a href="{% url 'noticias:detalhe' destaque.id %}" class="app-card app-card-progress-list h-100 shadow-sm">
									<img src="{{destaque.imagem_capa.url}}" class="img-fluid" alt="{{destaque.alt_capa}}" style="border-radius: 10px;">
								</a>
							</div>
							{% endfor %}
						</div>
						
					</div>
				</div>
				{% endcomment %}
					<div class="row app-card">
						<div class="col">
							<br>
							<h3 class="py-2 px-3">Últimas Notícias</h3>
							{% for noticia in noticias %}
							
							<div class="row mt-4">
								<a href="{% url 'noticias:detalhe' noticia.id %}" class="col-lg-4 col-sm-12 d-flex flex-column d-flex">							
									<img src="{{noticia.imagem_capa.url}}" class="m-auto img-fluid" alt="{{noticia.alt_capa}}" style="border-radius: 10px;">									
								</a>
								<div class="col d-flex flex-column pe-5">
									<p style="font-size: 20pt; line-height: auto; color: #1b1b1b !important;" class="mt-1 mb-0 pb-0">
										<strong class="my-0 py-0">{{noticia.titulo}}</strong>
									</p>
									<p style="line-height: auto;" class="my-0 py-0">
										<span class="my-0 py-0" style="font-size: 8pt;">{{noticia.dt_inclusao|date:"d/m/y	"}}</span>										
									</p>
									<p class="text-justify">
										{{noticia.resumo}}	
									</p>
									<a href="{% url 'noticias:detalhe' noticia.id %}" >
										Ler mais
									</a>
								</div>
							</div>
							
							{% endfor %}
							<button class="mt-4 mb-3 btn w-100 btn-primary text-white">
								ver mais
							</button>
						</div>
						
					</div>					
				


				{% if chamados_abertos_ou_pendentes %}
				<div id="meuModal" class="meu-modal-overlay">
					<div class="meu-modal-content">
						<span class="meu-modal-fechar">&times;</span>
						<h2>Chamados Pendentes</h2>
						<p>Olá! Parece que você possui alguns chamados pendentes. Aqui está a lista para que você possa conferir else:</p>
						<div class="row">
							<div class="col d-flex flex-wrap chamado-card-container">
								{% for chamado in chamados_abertos_ou_pendentes %}
								<div class="chamado-card{% if forloop.last %} me-auto{% endif %}">
									<div class="chamado-topo">
										<div class="d-flex w-100 mb-3">
											<div class="chamado-id">{{ chamado.n_protocolo }}</div>							
											<span class="tag ms-auto">
												<div class="chamado-tags">
													<span class="tag {{ chamado.get_prioridade_class }}">{{ chamado.get_prioridade_display }}</span>
													<span class="tag {{ chamado.get_status_class }}">{{ chamado.get_status_display }}</span>
												</div>
											
										</span>	
										</div>
										
										<div class="chamado-titulo">{{ chamado.assunto|default:"Sem assunto" }}</div>
									</div>
									<div class="chamado-detalhes">
										<p class="chamado-meta">
											{{ chamado.requisitante.nome|default:"-" }}
										</p>
										<p class="chamado-meta">
											{{ chamado.getCreateTime }}
										</p>														
									</div>
									<a href="{% url 'chamados:detalhes' chamado.hash %}" class="mt-auto btn-ver mx-auto" target="_blank">Visualizar chamado</a>
								</div>	
								{% endfor %}
							</div>
						</div>

					</div>
				</div>
				<style>
					/* Overlay escuro ao fundo */
					.meu-modal-overlay {
					display: none;
					position: fixed;
					top: 0;
					left: 0;
					width: 100%;
					height: 100%;
					background-color: rgba(0, 0, 0, 0.5);
					z-index: 1050; /* acima do conteúdo normal, abaixo de tooltips bootstrap se necessário */
					}

					/* Conteúdo do modal */
					.meu-modal-content {
					position: absolute;
					top: 50%;  /* ajuste vertical */
					left: 50%; /* ajuste horizontal */
					transform: translate(-50%, -50%);
					background-color: #fff;
					padding: 2rem;
					border-radius: 8px;
					width: auto; /* ✅ Altere o tamanho aqui */
					width: 90%;
					box-shadow: 0 5px 15px rgba(0,0,0,0.3);
					}

					/* Botão de fechar */
					.meu-modal-fechar {
					position: absolute;
					top: 10px;
					right: 15px;
					font-size: 24px;
					cursor: pointer;
					}
					/* Estrutura geral */
					.chamado-card {
					width: 400px;
					background-color: #e5fdfc;
					border-radius: 8px;
					border: 1px solid #e1e1e1;
					padding: 1rem;
					margin-bottom: 1.2rem;
					box-shadow: 0 1px 3px rgba(0,0,0,0.05);
					display: flex;
					flex-direction: column;
					gap: 0.6rem;
					font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
					margin-right: 10px;
					}

					/* Topo com ID e status alinhado à direita */
					.chamado-topo {
					display: flex;
					flex-direction: column;
					/* justify-content: space-between;
					align-items: center; */
					}

					.chamado-id {
					font-weight: 600;
					color: #333;
					font-size: 0.9rem;
					margin-bottom: 2px;
					}

					.chamado-titulo {
					font-size: 1.1rem;
					font-weight: 500;
					color: #1e1e1e;
					}

					/* Metadados e tags */
					.chamado-meta {
					font-size: 0.8rem;
					color: #333232;
					line-height: auto;
					margin: 0 auto;
					}

					.chamado-tags {
					display: flex;
					flex-wrap: wrap;
					gap: 0.4rem;
					margin-top: 0.3rem;
					}

					/* Tags */
					.tag {
					font-size: 0.75rem;
					padding: 0px 8px;
					border-radius: 999px;
					color: #fff;
					white-space: nowrap;
					}

					.status-novo {
					background-color: #2ecc71;
					}

					.status-aberto {
					background-color: #007bff;
					}

					.status-atendimento {
					background-color: #17a2b8;
					}

					.status-pendente {
					background-color: #fd7e14;
					}

					.status-fechado {
					background-color: #6c757d;
					}

					.status-finalizado {
					background-color: #343a40;
					}

					.status-cancelado {
					background-color: #b71c1c;
					}

					.status-mesclado {
					background-color: #8e24aa;
					}

					/* Prioridades */
					.prioridade-nao-definida {
					background-color: #6c1b6c;
					}

					.prioridade-baixa {
					background-color: #28a745;
					}

					.prioridade-media {
					background-color: #ffc107;
					color: #333;
					}

					.prioridade-alta {
					background-color: #dc3545;
					}

					/* Botão de visualização */
					.btn-ver {
					align-self: flex-start;
					margin-top: 0.5rem;
					background-color: #007bff;
					color: #e9ecef;
					text-decoration: none;
					padding: 2px 12px;
					border-radius: 6px;
					font-size: 0.85rem;
					transition: background-color 0.2s ease;
					}

					.btn-ver:hover {
					background-color: #dee2e6;
					}
					.meu-modal-content {
					max-height: 80vh;
					overflow-y: auto;
					}
					.chamado-card-container {
						display: flex;
						flex-wrap: wrap;
						/* gap: 10px; */
						justify-content:space-around;
					}
					.chamado-card {
						width: 400px;
						min-width: 400px;
						max-width: 400px;
						}
					@media (max-width: 1700px) {
						.chamado-card {
							width: 400px;
							min-width: 400px;
							max-width: 400px;
						}
					}
					@media (max-width: 900px) {
						.chamado-card {
							width: 100%;
							min-width: 0;
							max-width: 100%;
						}
					}
				</style>
				<script>
					document.getElementById('meuModal').style.display = 'block';

					document.querySelector('.meu-modal-fechar').onclick = function () {
					document.getElementById('meuModal').style.display = 'none';
					};

					window.onclick = function (event) {
					const modal = document.getElementById('meuModal');
					if (event.target === modal) {
						modal.style.display = 'none';
					}
					};

				</script>
				{% endif %}
				<script src="/static/plugins/chart.js/chart.min.js"></script> 
<script>
    'use strict';

	window.chartColors = {
	green: '#75c181',
	gray: '#a9b5c9',
	text: '#252930',
	border: '#e7e9ed'
};

// Dados de chamados

var semanas = {{ semanas|safe }};
var dados_abertos = {{ dados_abertos|safe }};
var dados_fechados = {{ dados_fechados|safe }};


var count_abertos = {{ count_abertos }};
var count_fechados = {{ count_fechados }};

// Dados para o gráfico de barras
var chamados_por_tipo = {{ chamados_por_tipo|safe }};

// Chart.js Line Chart Example
var lineChartConfig = {
	type: 'line',

	data: {
		labels: semanas,

		datasets: [{
                label: 'Chamados Abertos',
                fill: false,
                backgroundColor: window.chartColors.green,
                borderColor: window.chartColors.green,
                data: dados_abertos
            }, {
                label: 'Chamados Fechados',
                fill: false,
                backgroundColor: window.chartColors.gray,
                borderColor: window.chartColors.gray,
                data: dados_fechados
            }]
	},
	options: {
		responsive: true,
		aspectRatio: 1.5,

		legend: {
			display: true,
			position: 'bottom',
			align: 'end',
		},

		title: {
			display: false,
			text: 'Quantidade de Chamados',
		},
		tooltips: {
			mode: 'index',
			intersect: false,
			titleMarginBottom: 10,
			bodySpacing: 10,
			xPadding: 16,
			yPadding: 16,
			borderColor: window.chartColors.border,
			borderWidth: 1,
			backgroundColor: '#fff',
			bodyFontColor: window.chartColors.text,
			titleFontColor: window.chartColors.text,

			callbacks: {
				label: function(tooltipItem, data) {
					return tooltipItem.yLabel;
				}
			},

		},
		hover: {
			mode: 'nearest',
			intersect: true
		},
		scales: {
			xAxes: [{
				display: true,
				gridLines: {
					drawBorder: false,
					color: window.chartColors.border,
				},
				scaleLabel: {
					display: false,
				}
			}],
			yAxes: [{
				display: true,
				gridLines: {
					drawBorder: false,
					color: window.chartColors.border,
				},
				scaleLabel: {
					display: false,
				},
				ticks: {
					beginAtZero: true,
					userCallback: function(value, index, values) {
						return value;
					}
				},
			}]
		}
	}
};

// Chart.js Bar Chart Example
var barChartData = {
	labels: chamados_por_tipo.map(function(item) { return item.tipo; }),
	datasets: [{
		label: 'Quantidade de Chamados por Tipo',
		backgroundColor: window.chartColors.green,
		borderColor: window.chartColors.green,
		borderWidth: 1,
		data: chamados_por_tipo.map(function(item) { return item.quantidade; })
	}]
};

var barChartConfig = {
	type: 'bar',
	data: barChartData,
	options: {
		responsive: true,
		aspectRatio: 1.5,

		legend: {
			display: true,
			position: 'bottom',
			align: 'end',
		},

		title: {
			display: false,
			text: 'Quantidade de Chamados por Tipo',
		},
		tooltips: {
			mode: 'index',
			intersect: false,
			titleMarginBottom: 10,
			bodySpacing: 10,
			xPadding: 16,
			yPadding: 16,
			borderColor: window.chartColors.border,
			borderWidth: 1,
			backgroundColor: '#fff',
			bodyFontColor: window.chartColors.text,
			titleFontColor: window.chartColors.text,

			callbacks: {
				label: function(tooltipItem, data) {
					return tooltipItem.yLabel;
				}
			},

		},
		hover: {
			mode: 'nearest',
			intersect: true
		},
		scales: {
			xAxes: [{
				display: true,
				gridLines: {
					drawBorder: false,
					color: window.chartColors.border,
				},
				scaleLabel: {
					display: false,
				}
			}],
			yAxes: [{
				display: true,
				gridLines: {
					drawBorder: false,
					color: window.chartColors.border,
				},
				scaleLabel: {
					display: false,
				},
				ticks: {
					beginAtZero: true,
					userCallback: function(value, index, values) {
						return value;
					}
				},
			}]
		}
	}
};




// Generate charts on load
window.addEventListener('load', function(){
	
	var lineChart = document.getElementById('canvas-linechart').getContext('2d');
	window.myLine = new Chart(lineChart, lineChartConfig);
	
	var barChart = document.getElementById('canvas-barchart').getContext('2d');
	window.myBar = new Chart(barChart, barChartConfig);
	

});	
	

</script>
{% endblock %}