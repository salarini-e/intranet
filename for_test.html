<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Ponto</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f7f7f7;
            color: #202124;
        }
        .container {
            margin-top: 50px;
        }
        .card {
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            border: none;
            background-color: white;
        }
        .card-header {
            background-color: #ffffff;
            color: rgb(0, 0, 0);
            padding: 15px;
            text-align: center;
            font-size: 1.25rem;
            border-radius: 8px 8px 0 0;
        }
        .form-group label {
            font-weight: 500;
            font-size: 1rem;
        }
        .btn-ponto {
            border-radius: 8px;
            padding: 12px;
            font-size: 1.1rem;
            font-weight: 500;
        }
        .btn-entrada {
            background-color: #34a853;
            border: none;
            transition: background-color 0.3s ease;
        }
        .btn-saida {
            background-color: #ea4335;
            border: none;
            transition: background-color 0.3s ease;
        }
        .btn-entrada:disabled, .btn-saida:disabled {
            background-color: #a1c4b4;
        }
        .btn-entrada:hover {
            background-color: #2c9c47;
        }
        .btn-saida:hover {
            background-color: #c1351d;
        }
        .status {
            font-weight: 500;
            text-align: center;
            font-size: 1.1rem;
            color: #34a853;
            margin-top: 15px;
        }
        .status.inactive {
            color: #ea4335;
        }
        .d-flex {
            justify-content: center;
        }
        .d-grid {
            gap: 1rem;
        }
        .total-hours {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a73e8;
            margin-top: 20px;
            text-align: center;
        }
        /* .tab-content {
            padding-top: 20px;
        }
             */
    </style>
</head>
<body>
    <div class="container">
        <ul class="nav nav-tabs" id="pontoTab" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="tabRegistro" data-bs-toggle="tab" href="#registro" role="tab" aria-controls="registro" aria-selected="true">Registrar Ponto</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="tabHistorico" data-bs-toggle="tab" href="#historico" role="tab" aria-controls="historico" aria-selected="false">Histórico de Pontos</a>
            </li>
        </ul>

        <div class="tab-content" id="pontoTabContent">
            <div class="tab-pane fade show active" id="registro" role="tabpanel" aria-labelledby="tabRegistro">
                <div class="card">
                    <div class="card-header">
                        Sistema de Ponto
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-center">
                            <div class="text-center">
                                <h3 id="horaAtual">Hora Atual: 00:00:00</h3>
                                <div id="status" class="status inactive">Você ainda não bateu o ponto</div>
                                <div class="d-flex d-grid gap-2 mt-4">
                                    <button class="btn btn-entrada btn-ponto" id="btnRegistrar" onclick="registrarPonto()">Registrar Ponto</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="historico" role="tabpanel" aria-labelledby="tabHistorico">
                <div class="card">
                    <div class="card-header">
                        Histórico de Pontos
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Entrada 1</th>
                                    <th>Saída 1</th>
                                    <th>Entrada 2</th>
                                    <th>Saída 2</th>
                                    <th>Total de Horas</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
    <script>
        let estado = 'entrada1';
        let historico = [];

        function atualizarHoraAtual() {
            const agora = new Date();
            const hora = String(agora.getHours()).padStart(2, '0');
            const minuto = String(agora.getMinutes()).padStart(2, '0');
            const segundo = String(agora.getSeconds()).padStart(2, '0');
            document.getElementById('horaAtual').innerText = `Hora Atual: ${hora}:${minuto}:${segundo}`;
        }

        setInterval(atualizarHoraAtual, 1000);

        function registrarPonto() {
            const agora = new Date();
            const hora = `${agora.getHours()}:${agora.getMinutes()}:${agora.getSeconds()}`;
            const data = `${agora.getDate()}/${agora.getMonth() + 1}/${agora.getFullYear()}`;
            let statusMessage = '';
            let statusClass = 'inactive';
            let buttonClass = 'btn-entrada';
            let buttonText = 'Registrar Ponto';

            if (estado === 'entrada1') {
                statusMessage = 'Primeira Entrada registrada!';
                statusClass = 'active';
                buttonClass = 'btn-saida';
                buttonText = 'Registrar Saída';
                historico.push({ data, entrada1: hora, saida1: '', entrada2: '', saida2: '', totalHoras: '' });
                estado = 'saida1';
            } else if (estado === 'saida1') {
                statusMessage = 'Primeira Saída registrada!';
                statusClass = 'active';
                buttonClass = 'btn-entrada';
                buttonText = 'Registrar Entrada';
                historico[historico.length - 1].saida1 = hora;
                estado = 'entrada2';
            } else if (estado === 'entrada2') {
                statusMessage = 'Segunda Entrada registrada!';
                statusClass = 'active';
                buttonClass = 'btn-saida';
                buttonText = 'Registrar Saída';
                historico[historico.length - 1].entrada2 = hora;
                estado = 'saida2';
            } else if (estado === 'saida2') {
                statusMessage = 'Segunda Saída registrada!';
                statusClass = 'active';
                buttonClass = 'btn-entrada';
                buttonText = 'Registrar Entrada';
                historico[historico.length - 1].saida2 = hora;
                estado = 'entrada1';
            }

            document.getElementById('status').innerText = statusMessage;
            document.getElementById('status').classList.remove('inactive');
            document.getElementById('status').classList.add(statusClass);

            document.getElementById('btnRegistrar').classList.remove('btn-entrada', 'btn-saida');
            document.getElementById('btnRegistrar').classList.add(buttonClass);
            document.getElementById('btnRegistrar').innerText = buttonText;

            atualizarHistorico();

            if (estado === 'entrada1') {
                document.getElementById('btnRegistrar').disabled = false;
            } else if (estado === 'saida2') {
                document.getElementById('btnRegistrar').disabled = false;
            }
        }

        function atualizarHistorico() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';

            historico.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.data}</td>
                    <td>${item.entrada1}</td>
                    <td>${item.saida1 || '-'}</td>
                    <td>${item.entrada2 || '-'}</td>
                    <td>${item.saida2 || '-'}</td>
                    <td>${calcularHoras(item)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function calcularHoras(item) {
            // Função auxiliar para converter string de data e hora para objeto Date
            function converterDataHora(dataHora) {
                const partes = dataHora.split(' ');
                const data = partes[0].split('/');
                const hora = partes[1].split(':');
                return new Date(data[2], data[1] - 1, data[0], hora[0], hora[1], hora[2]);
            }

            let totalHoras = 0;

            // Converter as strings de data e hora para objetos Date
            const entrada1 = converterDataHora(item.DataEntrada + ' ' + item.Saída1);
            const saida1 = converterDataHora(item.DataEntrada + ' ' + item.Saída1);
            const entrada2 = converterDataHora(item.DataEntrada + ' ' + item.Entrada2);
            const saida2 = converterDataHora(item.DataEntrada + ' ' + item.Saída2);

            // Verificar se as datas são válidas e calcular a diferença
            if (entrada1 && saida1 && entrada2 && saida2) {
                totalHoras = (saida2 - entrada2) + (saida1 - entrada1);
            } else if (entrada1 && saida1) {
                totalHoras = saida1 - entrada1;
            }

            // Converter a diferença em horas e formatar
            const horas = Math.floor(totalHoras / (1000 * 60 * 60));
            const minutos = Math.floor((totalHoras % (1000 * 60 * 60)) / (1000 * 60));
            return `${horas}h ${minutos}m`;
        }
    </script>
</body>
</html>
